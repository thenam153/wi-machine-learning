const moduleName = "convergenceAnalysis";
const componentName = "convergenceAnalysis";
module.exports.name = moduleName;

const app = angular.module(moduleName, [
    'wiTreeView',
    'wiDroppable',
    'angularResizable',
    'wiTreeViewVirtual',
    'wiApi',
    'mlApi',
    'sideBar',
    'plot-toolkit'
]);

app.component(componentName,{
    template: require('./template.html'),
    controller: ConvergenceAnalysisController,
    style: require('./style.less'),
    controllerAs: 'self',
    bindings: {
        controller: '<'
    }
});

ConvergenceAnalysisController.$inject = ['$scope', 'wiApi', '$timeout', 'mlApi']
function ConvergenceAnalysisController($scope, wiApi, $timeout, mlApi){
    let self = 	this;
    this.$onInit = function() {
        self.setTab(0);
        self.xMinorTick = 1;
        self.xMajorTick = 10;
        self.yMinorTick = 1;
        self.yMajorTick = 10;

        $scope.$watchCollection(() => {
            return (self.controller.convergenceAnalysis || {}).train_loss;
        }, (newVal, oldVal) => {
            self.train_loss = newVal;
        })
        $scope.$watchCollection(() => {
            return (self.controller.convergenceAnalysis || {}).val_loss;
        }, (newVal, oldVal) => {
            self.val_loss = newVal;
        })
    }

    this.getLeft = function() {
        return 0;
    }
    this.getRight = function() {
        let l = self.train_loss.length;
        return parseInt((l / 10) + 1) * 10;
    }
    this.getBottom = function() {
        return 0;
    }
    this.getTop = function() {
        let max = Math.ceil(_.maxBy([...self.train_loss, ...self.val_loss], i => i));
        return parseInt((max / 10) + 1) * 10;
    }

    this.getX = function(d, i) {
        return i;
    }
    this.getY = function(d, i) {
        return d;
    }

    this.isTab = function(tabNum) {
        return self.tab === tabNum;
    }
    this.setTab = function(tabNum) {
        self.tab = tabNum;
    }
    this.getTab = function() {
        return self.tab;
    }

    this.plotCondition = function() {
        return (self.train_loss && self.train_loss.length)
            || (self.val_loss && self.val_loss.length);
    }

	//this.val_loss = [
		//538.0905329290935,
		//500.9388677020925,
		//357.93673008194185,
		//151.64496344958292,
		//108.42007805364382,
		//100.19830771391416,
		//93.80336423076713,
		//89.84941654693279,
		//86.99944300886894,
		//84.79697276101255,
		//83.59491033153442,
		//83.01422071244471,
		//81.83893143606858,
		//82.83622066591182,
		//84.20060610685324,
		//87.01142756139812,
		//91.26583372670834,
		//95.78192432978217,
		//100.52082040010865,
		//102.62412196241665,
		//104.53819924710172,
		//106.37565054218793,
		//105.59269990822499,
		//107.03372954594245,
		//107.23645049880116,
		//106.41055532592625,
		//106.94049522843444,
		//106.60295523205332,
		//106.75658049598034,
		//106.90344196323656,
		//106.65316918196585,
		//106.64301472310495,
		//106.25562417807625,
		//106.01760271170681,
		//107.50125296612072,
		//107.61090522444952,
		//106.01833314125196,
		//105.84253627475967,
		//108.174962936956,
		//107.2320901232206,
		//107.65022614808164,
		//106.14030036587977,
		//106.01899586685782,
		//107.89676889599251,
		//106.82196331651996,
		//107.1055308760991,
		//107.57808860722255,
		//107.59385094162162,
		//107.00617953792286,
		//107.25361140932978,
		//106.68031248783163,
		//106.69811555949872,
		//107.42042880016498,
		//107.83870348136419,
		//105.44916349984285,
		//106.44971989885836,
		//106.73601548113923,
		//106.58146102263821,
		//108.37174770447194,
		//106.67862836110243,
		//107.05792395856507,
		//106.79687378619515,
		//106.92363562726568,
		//107.40688580628729,
		//106.77577320899448,
		//107.33959358254471,
		//107.19672249311492
	//];
	//this.train_loss = [
		//541.9746888583716,
		//512.4709454835511,
		//434.38015041722747,
		//246.43288106369474,
		//106.15451994022057,
		//74.89284504679632,
		//59.376990852843775,
		//49.19869732166185,
		//42.1878866973264,
		//36.80606228100104,
		//32.346087676434394,
		//28.61632991542814,
		//25.175922482410957,
		//21.860188146989113,
		//18.92081044819033,
		//16.576540455871285,
		//14.601813433914804,
		//12.833026392598116,
		//11.791256391413722,
		//11.24284388917693,
		//10.981282107422786,
		//10.858145542118294,
		//10.78699976022766,
		//10.734833113246902,
		//10.696461818613594,
		//10.652958814445235,
		//10.624871039567408,
		//10.591136407630135,
		//10.573919027606728,
		//10.545065103290183,
		//10.521943605540892,
		//10.508680159245799,
		//10.469429573256571,
		//10.444215659887673,
		//10.42162829051228,
		//10.416274809830334,
		//10.375347495527688,
		//10.370471786471906,
		//10.348961842233042,
		//10.320643233739807,
		//10.320834408508537,
		//10.295498702015017,
		//10.267377893535011,
		//10.265705597549573,
		//10.239620030404895,
		//10.214996364196818,
		//10.211135297989141,
		//10.177371450764191,
		//10.16919730770634,
		//10.172325961184145,
		//10.148218213783423,
		//10.126332953136435,
		//10.118068243798891,
		//10.118252358862343,
		//10.117460219294548,
		//10.093789228141247,
		//10.072676635476869,
		//10.074738403595683,
		//10.046223993191939,
		//10.047627714450202,
		//10.03901782287774,
		//10.021270470345256,
		//10.018712787598318,
		//10.00751246452149,
		//10.001487207239656,
		//10.001762570440231,
		//10.004986917241416
	//];
}
